{% extends 'base.html' %}
{% load static %}

{% block title %}
Wishlist
{% endblock title %}

{% block css %}
{% endblock css %}

{% block content %}
	<!-- pages-title-start -->
	<div class="pages-title section-padding">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<div class="pages-title-text text-center">
						<h2>Wishlist</h2>
						<ul class="text-left">
							<li><a href="{% url 'home:home_page' %}">Home </a></li>
							<li><span> // </span>Wishlist</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- pages-title-end -->
	<!-- wishlist content section start -->
	<section class="pages wishlist-page section-padding">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<div class="table-responsive padding60">
						<table class="wishlist-table text-center">
							<thead>
								<tr>
									<th>Product</th>
									<th>Price</th>
									<th>Stock Status </th>
									<th>Add To Cart</th>
									<th>Remove</th>
								</tr>
							</thead>
							<tbody id="wishlist">
								{% for object in object_list.first.product_variation.all %}
								{{object_list.first}}
								{{object_list.first.id}}
								{{object}}
								{{object.id}}
								<tr>
									<td class="td-img text-left">
										<a href="#"><img src="{{object.main_image.url}}" alt="Add Product" /></a>
										<div class="items-dsc">
											<h5><a href="#">{{ object.product.name }}</a></h5>
											{% for attribute in object.product_attribute_values.all %}
												<p class="itemcolor">{{attribute.attribute.name}} : <span>{{attribute.value}}</span></p>
											{% endfor %}
										</div>
									</td>
									<td>${{object.price}}</td>
									{% if object.stock_status %}
									<td>In Stock</td>
									{% else %}
									<td>Out of Stock</td>
									{% endif %}
									<td>
										<div class="submit-text">
											<a href="cart.html">Add to cart</a>
										</div>
									</td>
									<td><i class="mdi mdi-close" title="Remove this product" onclick="deleteProduct({{object_list.first.id}},{{object.id}});"></i></td>
								</tr>
								{% endfor %}

								<script>
									function deleteProduct(id, i_d) {
										console.log(id);
										const url = `http://localhost:8000/api/wishlist/${id}/${i_d}/`;
										
										fetch(url, {
											method: 'DELETE',
											headers: {
												'X-CSRFToken': getCookie('csrftoken'),
											}
										})
										.then(response => {
											if (response.ok) {
												alert('Product removed from wishlist successfully');
												window.location.reload();
											} else {
												alert('Error removing product from wishlist');
											}
										})
										.catch(error => {
											alert('Error removing product from wishlist:', error);
										});
									}
									  
									  function getCookie(name) {
										let cookieValue = null;
										if (document.cookie && document.cookie !== '') {
										  const cookies = document.cookie.split(';');
										  for (let i = 0; i < cookies.length; i++) {
											const cookie = cookies[i].trim();
											if (cookie.substring(0, name.length + 1) === (name + '=')) {
											  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
											  break;
											}
										  }
										}
										return cookieValue;
									  }
								</script>

							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- wishlist content section end -->
{% endblock content %}

{% block js %}
{% endblock js %}






